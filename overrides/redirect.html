{#
  Redirect template for versioned docsets.
  Automatically redirects to the latest version based on nav structure.

  This template outputs a minimal redirect page with JavaScript executing
  before any other content loads.
#}
{%- set versioned_docsets = config.extra.versioned_docsets or [] -%}
{%- set current_path = page.url | default('') -%}
{%- set ns = namespace(redirect_url='', docset='') -%}
{%- for docset_slug in versioned_docsets -%}
  {%- if current_path.startswith(docset_slug ~ '/') or current_path == docset_slug ~ '/' -%}
    {%- set ns.docset = docset_slug -%}
    {%- for nav_item in nav -%}
      {%- set nav_title_slug = nav_item.title | lower | replace(' ', '-') -%}
      {%- if nav_title_slug == docset_slug and nav_item.children -%}
        {%- for child in nav_item.children -%}
          {%- if child.title != 'Development' and not ns.redirect_url -%}
            {%- set ns.redirect_url = '/' ~ docset_slug ~ '/' ~ (child.title | lower | replace('.', '-') | replace(' ', '-')) ~ '/' -%}
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}
    {%- endfor -%}
  {%- endif -%}
{%- endfor -%}
<!DOCTYPE html>
<html>
<head>
<script>window.location.replace("{{ ns.redirect_url }}" + window.location.hash);</script>
<meta http-equiv="refresh" content="0; url={{ ns.redirect_url }}">
<link rel="canonical" href="{{ config.site_url }}{{ ns.docset }}/">
<meta charset="utf-8">
<title>Redirecting...</title>
</head>
<body></body>
</html>

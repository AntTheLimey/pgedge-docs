{% set class = "md-tabs" %}
{% if "navigation.tabs.sticky" in features %}
  {% set class = class ~ " md-tabs--sticky" %}
{% endif %}

{# Get nav categories from mkdocs.yml extra section #}
{% set nav_categories = config.extra.nav_categories or {} %}

{# Macro to render a dropdown menu #}
{% macro dropdown_menu(label, category_items, nav_items, dropdown_id) %}
<li class="md-tabs__item md-tabs__dropdown" data-dropdown-id="{{ dropdown_id }}">
  <button type="button" class="md-tabs__dropdown-toggle" aria-expanded="false" aria-haspopup="true">
    <span>{{ label }}</span>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="md-tabs__dropdown-icon">
      <path d="M7 10l5 5 5-5z" fill="currentColor"/>
    </svg>
  </button>
  <ul class="md-tabs__dropdown-menu">
    {# Process each category item - render directly using title and url #}
    {% for cat_item in category_items %}
      {% if cat_item is string %}
        {% set cat_title = cat_item %}
        {% set cat_url = "." %}
      {% else %}
        {% set cat_title = cat_item.title %}
        {% set cat_url = cat_item.url | default(".") %}
      {% endif %}
      <li class="md-tabs__dropdown-item">
        <a href="{{ cat_url | url }}" class="md-tabs__dropdown-link">
          {{ cat_title }}
        </a>
      </li>
    {% endfor %}
  </ul>
</li>
{% endmacro %}

<nav class="{{ class }}" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      {# Welcome link #}
      {% for nav_item in nav %}
        {% if loop.first %}
          <li class="md-tabs__item">
            <a href="{{ nav_item.url | url }}" class="md-tabs__link">
              {{ nav_item.title | striptags }}
            </a>
          </li>
        {% endif %}
      {% endfor %}

      {# VM / Bare Metal dropdown #}
      {% if 'VM / Bare Metal' in nav_categories %}
        {{ dropdown_menu('VM / Bare Metal', nav_categories['VM / Bare Metal'], nav, 'vm-bare-metal') }}
      {% endif %}

      {# Containers dropdown #}
      {% if 'Containers' in nav_categories %}
        {{ dropdown_menu('Containers', nav_categories['Containers'], nav, 'containers') }}
      {% endif %}

      {# pgEdge Cloud - direct link, no dropdown #}
      {% for nav_item in nav %}
        {% if nav_item.title | striptags | trim == 'pgEdge Cloud' %}
          <li class="md-tabs__item">
            <a href="{{ nav_item.url | url if nav_item.url else (nav_item.children | first | attr('url') | url) }}" class="md-tabs__link">
              pgEdge Cloud
            </a>
          </li>
        {% endif %}
      {% endfor %}

      {# AI Toolkit dropdown #}
      {% if 'AI Toolkit' in nav_categories %}
        {{ dropdown_menu('AI Toolkit', nav_categories['AI Toolkit'], nav, 'ai-toolkit') }}
      {% endif %}

      {# Extensions dropdown #}
      {% if 'Extensions' in nav_categories %}
        {{ dropdown_menu('Extensions', nav_categories['Extensions'], nav, 'extensions') }}
      {% endif %}

      {# Tools dropdown #}
      {% if 'Tools' in nav_categories %}
        {{ dropdown_menu('Tools', nav_categories['Tools'], nav, 'tools') }}
      {% endif %}
    </ul>
  </div>
</nav>
